# Active Directory에 사이트가 중요한 이유

## Active Directory의 사이트는 무엇인가?

전 장에서 Active Directory의 도메인컨트롤러는 중요한 역할이기때문에,  여러 개의 서버에서 운용하는 것, 그리고 각각의 서버(도메인컨트롤러)가 같은 데이터베이스를 가지도록 복제하는 법에 대해 설명했다. 이번에는 그 복제를 효과적으로 행하기 위해 사용되는 사이트에 대해 배워보자.

Active Directory에서의 사이트는 도메인컨트롤러끼리 복제를 할 때 "고속으로 통신 할 수 있는 범위" 를 나타낸다.  조직 안에서 동경 사무실, 오사카사무실로 나누어져 있을 때, 동경사무실안의 도메인컨트롤러가 2대라면 그 도메인컨트롤러끼리는 고속으로 통신 할 수 있다.

그러나 동경사무실과 오사카사무실 각각 도메인컨트롤러가 있을 경우에는 고속으로 통신한다고 한정 지을 수 없다. 그래서 동경사무실에서 한 개의 사이트, 오사카사무실에서 한 개의 사이트를 각각 만들면 각각의 사이트 내는 고속 통신 할 수 있는 범위로 정의 할 수 있다. 

![](image/ad_05/img01.PNG)

## Active Directory에서 사이트가 필요할까?

사이트는 고속 통신 할 수 있는 범위라고 소개했는데, 왜 이 범위를 일부러 정의 할 필요가 있을까? 그것은 도메인컨트롤러의 복제 타이밍에 이유가 있다. 전 장에서 복제는 Active Directory데이터베이스에 변경이 발생하면 15초후에 시작된다고 설명했다. 

예를 들면 동경의 도메인컨트롤러와 오사카의 도메인컨트롤러에서 복제를 실행하도록 구성해 놓았을 경우, 동경의 도메인컨트롤러에서 유저를 작성하면, 15초 후 오사카의 도메인컨트롤러를 향해 복제가 시작된다.  재차 동경의 도메인컨트롤러에서 유저를 작성하면 또 15초 후에 오사카의 도메인컨트롤러를 향해 복제가 시작된다. 

이 처럼 유저를 작성/변경/제거 등 Active Directory데이터 베이스에 대해 변경이 발생하면 그때마다 복제가 행해진다. 고속 통신 할 수 있는 도메인컨트톨러 사이라면 큰 문제가 아니다. 그러나 동경과 오사카처럼 지리적으로 떨어져 있고, 고속 통신이 어려운 범위라면 하나하나 복제하지않고 어느정도 모아두고 진행하도록 하고 싶다고 생각하는게 보통이다.  

여기서 Active Directory사이트에서는 사이트가 나누어져 있는 도메인컨트롤러끼리의 복제는 15초 이후가 아니라 「3시간간격」 (기본값) 으로 진행되도록 자동적으로 구성된다.  게다가 복제 내용을 압축해 전송되기 때문에 사이트간으로 통신 되는 데이터의 양을 줄이는 것도 가능하다. 이것이 사이트를 작성해서 Active Directory를 운용하는 큰 이유이다. 

![](image/ad_05/img02.PNG)

## 어느 사이트로부터 어느 사이트에 복제가 되는 걸까?

사이트내의 도메인컨트롤러의 복제에서는 복제 상대가 되는 도메인컨트롤러는 자동적으로 선택, 설정된다. 그러나 사이트가 다른 사이트와 복제를 행하는 경우, 복제 상대가 되는 사이트는 자동으로 선택되지않기 때문에 어느 사이트에서 복제 할지를 명시적으로 지정할 필요가 있다. 복제 상태가 되는 사이트의 지정은  「사이트링크」 로 불리는 설정에서 지정한다. 

예를 들면, 동경과 오사카라는 두개의 사이트가 있는 경우, 동경사이트와 오사카사이트에서 복제를 하려면 양방의 사이트가 포함된 사이트링크를 작성한다. 그렇게 하면 동경사이트의 도메인컨트롤러에서 유저를 작성하면 그 변경을 약 3시간후에 오사카 사이트의 도메인컨트롤러에 복제된다. 역으로 사이트를 작성해도 사이트링크를 작성하지않으면 사이트 간의 복제는 발생하지않는다.

![](image/ad_05/img03.PNG)

사이트링크를 작성하는 방법
<http://www.atmarkit.co.jp/ait/articles/0303/28/news002.html>

## 어느 도메인컨트롤러가 다른 사이트에 복제하는 걸까? 

사이트링크를 작성하면, 사이트 간의 복제가 행해진다고 설명했는데 사이트 중에 여러 개의 도메인컨트롤러가 있는 경우 과연 어느 도메인컨트롤러가 다른 사이트의 도메인컨트롤러에 대해 복제가 이루어질까 

Active Directory에서 사이트링크를 작성하면, 다른 사이트에 대해 복제를 행할 도메인컨트롤러가 자동으로 설정된다. 이 도메인컨트롤러는 「브리지헤드 서버」 라고 불리고 다른 사이트의 도메인컨트롤러에 대해 복제를 하는 역할을 갖는다. 

![](image/ad_05/img04.PNG)

브리지헤드 서버는 관리자가 명시적으로 브리지헤드서버가 되는 도메인컨트롤러를 지정하는 것이다. 지정한 도메인컨트롤러는 브리지헤드 서버로서 기능을 하고, 다른 사이트에 복제를 실행하게 된다. 

## 유저에게 있어서는 어떤 장점이 있을까?

지금까지, 도메인컨트롤러의 복제라고하는 관점부터 사이트에 대해서 설명을 해왔다. 여기서 이용자(유저)에게 있어 장점에 대해서 언급하고 싶다.

사이트는 복제를 컨트롤하는 목적 외에 유저가 로그인 할 때 액세스할 도메인컨트롤러를 선택하는 역할이 있다.

예를 들면 동경사이트와 오사카사이트가 있고 클라이언트 컴퓨터가 동경사이트에 배치 되어있을 때 클라이언트는 유저 인증을 하기 위해 가능하면 동경사이트에 있는 도메인컨트롤러에 접근 하고싶다고 생각할 것이다. 그런데 사이트를 인식하지않고 동경사이트에 있는 클라이언트가 오사카 사이트의 도메인컨트롤러에 접근한다고 하면 로그인이 오래 걸릴 것이다.

그래서 Active Directory사이트에서는 클라이언트 컴퓨터에 「저는 지금 어느 사이트에 있을까?」 라는 것을 인식시키고  같은 사이트에 있는 (아니면 제일 가까운 사이트에 있는) 도메인컨트롤러에 접근해 인증을 받을 수 있도록 한다. 

![](image/ad_05/img05.PNG)

이 같은 동작에 의해 유저는 어디에 있어도 항상 가까운 도메인컨트롤러와 통신을 하게 되고 빠르게 로그인 할 수 있다.

## 온프레미스와 클라우드는 사이트를 나누어야 하나?

IaaS(Infrastructure as a Service) 라고 불리는 서비스에 의해 가상머신자체를 클라우드에 배치 할 수 있도록 됐다. 그 결과, 도메인컨트롤러도 Disaster Recovery (재해대책) 대응의 일환으로 클라우드에 배치하는 경우도 많아졌다. 그래서 클라우드에 도메인컨트롤러를 배치할 때의 주의사항을 몇가지 설명하겠다. 

1. 사이트를 나누어 운용한다.
온프레미스 1대, 클라우드 1대와 도메인컨트롤러를 각각 배치하는 구성의 경우, 온프레미스의 도메인컨트롤러와 클라우드의 도메인컨트롤러의 사이는 일반적으로 VPN(Virtual Private Network)를 이용해 접근한다. 그리고 VPN접속에서의 통신은 보통의 경우는 보통 요금이 부과된다.
사이트내의 도메인컨트롤러를 복제하는 경우에 비해 사이트 간의 복제는 데이터가 압축된 만큼 비용을 줄일 수 있다. 온프레미스와 클라우드에 걸쳐있는 도메인컨트롤러를 배치하는 경우에는 사이트를 나누어 운용해야한다.

2. Azure를 이용할 경우는 읽기전용 DC의 활용을 검토한다.
Microsoft Azure의 IaaS에서 사용하는 가상네트워크는 클라우드로부터 온프레미스에의 통신만 요금을 부과한다. 그 때문에 Active Directory에 대한 변경은 전부 온프레미스만을 이용, 온프레미스로부터 클라우드에의 통신만 이루어 지도록 도메인컨트롤러를 운용하면 비용을 줄일 수 있다. 
Active Directory에는 읽기전용도메인컨트롤러(RODC)라고 불리는 도메인 컨트롤러가 있다.  Active Directory의 인스톨시에 RODC의 역할을 선택해 인스톨하면 기본적으로 RODC로부터 복제를 하는 것은 없어진다. 이 특성을 살려, RODC를 클라우드에 배치하면 클라우드로부터 온프레미스의 통신을 줄일 수 있다.

![](image/ad_05/img06.PNG)

읽기전용 도메인컨트롤러는 아래의 글을 참고해라.
<http://www.atmarkit.co.jp/ait/articles/0801/10/news135.html>

## 당신의 조직에서 사이트는 바르게 구성되어 있습니까?

조직 안에서 Active Directory의 운용 관리를 행하는 관리자에게 있어 일반적인 작업 중  Active Directory의 사이트를 의식하는 일은 거의 없을 것입니다. 

하지만 현재의  Active Directory의 구성이 어떻게 되어있는지, 적절한 구성으로 되어있는지 등을 알아두면 이후의  Active Directory이행작업등을 할 때 사이트의 특성을 감안한 Active Directory설계를 자신이 생각해, 보다 좋은 구성을 할 수 있을 것이다. 










