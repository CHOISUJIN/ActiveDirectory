# 도메인컨트롤러의 역할

전에 Active Directory은 말하자면 브랜드명이고, 그 안의 역할 중 하나로
「Active Directory Domain Service」라는 이름의 기능이 있는 것을 소개했다. 
그리고 Active Directory Domain Service의 역할을 제공하는 서버가 도메인컨트롤러가 된다.

서버에 Active Directory Domain Service의 역할을 인스톨하면, 그 서버는 자동으로 도메인컨트롤러가 된다. 그렇기때문에, Active Directory Domain Service = 도메인 컨트롤러라고 착각할 수도 있다. 반복해 말하자면 Active Directory, 도메인, 도메인컨트롤러의 관계는 아래와 같다.

	▪ Active Directory : 도메인의 기능을 중심으로 하는 마이크로소프트가 제공하는 기능 군의 이름.
	▪ 도메인 : 회사에 있는 컴퓨터나 유저 등을 관리하기위한 것.
    ▪ 도메인컨트롤러 : 도메인의 기능을 제공하는 서버.

관례적으로 도메인은 Active Directory 와 같은 의미로 전달되거나, Active Directory 도메인으로 부르거나 하는 경우가 있는데, 정확히는 위의 내용과 같이 차이점이 있다는 것을 기억해두자.

Active Directory, 도메인, 도메인컨트롤러의 차이점이 이해되었다면, 
다음은 도메인컨트롤러는 무엇인가? 무슨 일을 하는가? 어떤 메리트를 가지고있는가?에 대해 알아보자. 도메인컨트롤러가 제공하는 역할은 크게 3가지로 나뉜다. 

	▪ 디렉토리 데이터베이스로서의 역할
	▪ 인증과 승인의 역할
	▪ 그룹 정책에 의한 유저/ 컴퓨터를 제어하는 역할


##### 1. 디렉토리 데이터베이스로서의 역할

「디렉토리 데이터베이스」란, 도메인으로 이용하는 각종 데이터를 저장하는 데이터베이스이다. 보다 쉽게 말하자면, 유저명이나 비밀번호의 정보를 저장하는 곳이 디렉토리 데이터베이스이다. 

Active Directory에서 채용하고있는 디렉토리 데이터베이스는, 마이크로소프트의 독자규격이 아니라, 많은 디렉토리서비스에 설치된 LDAP라고 불리는 규격에 기초한 데이터베이스구조이다.

디렉토리 데이터베이스에 보존되는 데이터는 오브젝트라고 불리는 단위로 저장된다. 
그렇기 때문에 도메인에 유저를 작성하면, 그것은 유저라고하는 종류의 오브젝트를 작성한 것이 된다. 

그리고, 작성한 유저(오브젝트)에는 그 유저의 여러가지 항목을 등록할 수 있게 된다. 이 등록 가능한 항목을 프로퍼티 또는 속성이라고 부른다. 

![](image/ad_03/img01.PNG)

여기까지를 정리하면, 디렉토리 데이터베이스는 LDAP라고 불리는 규격에 기초,  데이터베이스안에는 오브젝트와 속성 정보(프로퍼티)의 관계로 유저 등을 관리하고있다.

그런데 1장에서는, 디렉토리 데이터베이스에 저장된 오브젝트는, 간단한 인사정보를 속성 정보로 등록할 수 있다고 소개했다. 이에 관해 이야기하면, 속성 정보를 등록하는 장점이 궁금해지겠지요. 유저명과 비밀번호는 로그인을 할 때 필요하므로 등록하지만, 그 외의 속성 정보를 왜 등록하는 것일까요?

2000년도에 등장한 Active Directory는, 속성 정보로 인사정보를 등록해도 활용 가능한 곳이 거의 없었다. 그러나 현재는 입력한 속성 정보로 활용할 수 있는 여러가지 기능들을 제공하고있다. 

###### ▪ 속성정보를 베이스로 그룹의 멤버를 등록

도메인환경에서 엑세스권을 설정하는 경우, 유저마다 개별로 설정하는 것은 번거롭기때문에, 유저를 그룹으로 묶어 엑세스권을 설정한다. 그룹에 포함된 유저에 대해 관리자가 수동으로 설정하는 것도 좋지만, 그것도 번거로운 작업이다.

예를 들어, 「영업부」라는 명의 그룹을 만들고, 영업부의 유저 전원을 이 그룹의 멤버로 하는 설정을 한다고 생각해보자.

이 경우, 유저의 부서속성에 「영업부」라고 설정해 두고, 부서 속성이 「영업부」로 설정되어있는 유저는 자동적으로 「영업부그룹」의 멤버가 되도록 스크립트를 작성해 두면 인사이동때마다 수동으로 그룹의 멤버를 재설정하는 수고가 줄어든다. 

###### ▪ 다이나믹 액세스 제어

Windows Server 2012의 Active Directory로부터 서포트 된 다이나믹 액세스제어는 그룹에 대해 액세스권설정과는 다른, 새로운 액세스권의 설정방법이다.

다이나믹 액세스 제어에서는, 그룹 단위가 아니라, 유저의 속성 정보를 가지고 액세스권을 설정할 수 있다. 예를 들어 「영업부」의 유저에게 액세스권을 설정하는 경우, 지금처럼 「영업부」라는 그룹을 만들고 액세스권을 설정하는게 아니라, 「영업부라는 속성을 가진 유저」에 대해 직접액세스권을 설정할 수 있다.

###### ▪ 웹 서버의 액세스 제어

Windows Server 2012 R2에서는 준비기능으로 웹어플리케이션 프록시라고 불리는  리버스프록시 기능이 제공된다.

예를 들어 외부에서 사내의 웹 서버에 액세스할 경우, 웹어플리케이션 프록시에서 사전에 인증/ 승인을 행한 후, 사내의 웹 서버에 접근할 수 있도록 제어할 수 있다.

이때 웹 어플리케이션 프록시의 승인 작업은 Active Directory Federation Service를 조합할 수 있기때문에, ADFS에 의한 설정으로 부서 속성이 영업부인 유저만 접근하도록 허가하는 것이 가능하다.

![](image/ad_03/img02.PNG)


##### 2. 인증과 승인의 역할

유저명에 대해 비밀번호가 맞는지 확인하는 작업을 인증, 유저가 접근할 수 있는 공유폴더등의 범위를 확인하는 작업을 승인이라고 한다. Active Directory 도메인에서는 이 인증과 승인의 역할을 도메인 안의 Kerberos라는 기능이 담당한다.

Kerberos는 도메인컨트롤러와 클라이언트 컴퓨터의 통신에 의해 입력된 유저명과 비밀번호의 조합이 일치하는지 확인(인증 작업 실시)과 동시에 특정서버에 접근할 수 있는지를 확인(승인 작업 실시)한다.  그렇기 때문에(일부 예외가 있지만) 인증과 승인을 할 때는 클라이언트 컴퓨터와 도메인컨트롤러와 통신할 수 있어야한다. 

![](image/ad_03/img03.PNG)

이제까지 Active Directory의 인증에 대해서는 유저명과 비밀먼호를 확인하는 작업이라고 소개했는데 사실은 Active Directory에는 컴퓨터의 인증 작업도 존재한다. 컴퓨터의 인증은 컴퓨터의 이름과 비밀번호를 전송해 일치하는지 확인한다. 

그런데, 유저의 인증은 유저의 이름과 동시에 비밀번호를 설정하지만 보통 Active Directory의 운용에서 컴퓨터의 비밀번호를 설정한 적 있는 사람은 없을 것이다.

컴퓨터의 비밀번호는 클라이언트 컴퓨터가 도메인을 이용할 때 도메인에 참가한다라는 최조의 조작에서 설정되고,  이 후 정기적으로 변경되어 도메인 컨트롤라와 클라이언트 컴퓨터간에 동기화된다. 

그래서 컴퓨터의 패스워드를 의식하지않아도 Active Directory의 운용이 가능하고, 또 클라이언트 컴퓨터는 도메인에 접속 설정을 할 필요가 있다. 

![](image/ad_03/img04.PNG)

##### 3. 그룹 정책에 의한 유저 / 컴퓨터를 제어하는 역할

도메인 컨트롤러에 저장된 정보는 또 하나 중요한 그룹 정책이라는 것이 있다. 그룹 정책은 도메인에 참가하는 컴퓨터나 유저에게 여러가지 설정을 적용하는 기능이다.

본래 클라이언트컴퓨터 한 대 한대 해야하는 설정이라도 도메인컨트롤러에서 한번에 그룹 정책을 설정하면 전체 클라이언트 컴퓨터에 그 설정을 자동적으로 할당할 수 있게 된다.  즉, 인해전술로 모든 클라이언트 컴퓨터를 수동으로 설정하러 돌아다니지 않아도 된다. 

그룹 정책의 설정은 도메인 컨트롤러에 보존되어 있고, 클라이언트 컴퓨터는 작동할 때나 도메인에 로그인할 때 그 설정을 받아들여 적용한다. 그렇기 때문에 그룹정책으로 새로운 설정을 행할 경우, 클라이언트 컴퓨터는 도메인컨트롤러에 접근하지않으면 새로운 설정을 받아들이지 못한다.

여기까지 도메인컨트롤라가 제공하는 기능과 그 필요성을 확인했다.  도메인컨트롤러는 도메인의 여러가지 기능을 제공하는 것 뿐만 아닌 도메인에 관한 데이터베이스를 가진 서버이기 때문에, 시스템중에서도 불가결한 존재이다.


































